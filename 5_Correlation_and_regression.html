<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alexandra Ils &amp; Johannes B. Gruber">
<meta name="dcterms.date" content="2023-03-28">

<title>Session 5: Text Correlations and Regression Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="5_Correlation_and_regression_files/libs/clipboard/clipboard.min.js"></script>
<script src="5_Correlation_and_regression_files/libs/quarto-html/quarto.js"></script>
<script src="5_Correlation_and_regression_files/libs/quarto-html/popper.min.js"></script>
<script src="5_Correlation_and_regression_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="5_Correlation_and_regression_files/libs/quarto-html/anchor.min.js"></script>
<link href="5_Correlation_and_regression_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="5_Correlation_and_regression_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="5_Correlation_and_regression_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="5_Correlation_and_regression_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="5_Correlation_and_regression_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#aim-of-this-session" id="toc-aim-of-this-session" class="nav-link active" data-scroll-target="#aim-of-this-session">Aim of this session:</a></li>
  <li><a href="#correlation" id="toc-correlation" class="nav-link" data-scroll-target="#correlation">Correlation</a>
  <ul class="collapse">
  <li><a href="#prepare-the-data" id="toc-prepare-the-data" class="nav-link" data-scroll-target="#prepare-the-data">Prepare the data</a>
  <ul class="collapse">
  <li><a href="#exercise-tasks" id="toc-exercise-tasks" class="nav-link" data-scroll-target="#exercise-tasks">Exercise Tasks</a></li>
  </ul></li>
  <li><a href="#perform-correlation" id="toc-perform-correlation" class="nav-link" data-scroll-target="#perform-correlation">Perform correlation</a>
  <ul class="collapse">
  <li><a href="#exercise-tasks-1" id="toc-exercise-tasks-1" class="nav-link" data-scroll-target="#exercise-tasks-1">Exercise Tasks</a></li>
  </ul></li>
  <li><a href="#plot-the-network-of-our-most-important-words" id="toc-plot-the-network-of-our-most-important-words" class="nav-link" data-scroll-target="#plot-the-network-of-our-most-important-words">Plot the network of our most important words</a>
  <ul class="collapse">
  <li><a href="#exercise-tasks-2" id="toc-exercise-tasks-2" class="nav-link" data-scroll-target="#exercise-tasks-2">Exercise Tasks</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression">Regression</a>
  <ul class="collapse">
  <li><a href="#exercise-tasks-3" id="toc-exercise-tasks-3" class="nav-link" data-scroll-target="#exercise-tasks-3">Exercise Tasks</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Session 5: Text Correlations and Regression Models</h1>
<p class="subtitle lead">Textanalyse in R: eine Einführung</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alexandra Ils &amp; Johannes B. Gruber </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 28, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="aim-of-this-session" class="level1">
<h1>Aim of this session:</h1>
<ul>
<li>Learn how to calculate correlation of words</li>
<li>Visualize the results</li>
</ul>
</section>
<section id="correlation" class="level1">
<h1>Correlation</h1>
<p>Correlation networks of words can tell us something about the context of words, which we have not yet discovered. While frequency counts can give a first information that is useful for interpreting the data, correlation of words can give us us a more in-depth view of our data. What words do often appear together? What conclusions can this offer to our research question?</p>
<section id="prepare-the-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-the-data">Prepare the data</h2>
<p>In this session we will first do the analysis using the <code>tidytext</code> as there is an excellent explanation of what is going on here in the companion book to this package (<a href="https://www.tidytextmining.com/ngrams.html#visualizing-a-network-of-bigrams-with-ggraph">see</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Load the packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(widyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As data source for this session we use Twitter dataset on the Iranian protests from Kaggle (we used this in session 3, so please go back and download it if you haven’t done so yet):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>iran_tweets_raw <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">"data/iran_tweets.csv.zip"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before doing the actual analysis we do some cleaning and preprocessing (as always).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>iran_tweets <span class="ot">&lt;-</span> iran_tweets_raw <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># first, get proper date and timestamps</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">created_at =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hms</span>(date),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(created_at),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># second, we make a unique status ID since one is missing from this data. I</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use the hash function from rlang, which turns data into strings</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">status_id =</span> <span class="fu">map_chr</span>(<span class="fu">paste0</span>(created_at, text, user_name), rlang<span class="sc">::</span>hash))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `created_at = lubridate::ymd_hms(date)`.
Caused by warning:
!  2 failed to parse.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>iran_tweets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 546,532 × 14
   user_name          user_location user_description user_created user_followers
   &lt;chr&gt;              &lt;chr&gt;         &lt;chr&gt;            &lt;chr&gt;                 &lt;dbl&gt;
 1 pikkolo            "Germany"     "Norddeutscher … 2022-02-26 …            106
 2 𝓘𝓻𝓪𝓷 𝓟𝓪𝓷𝓸𝓻𝓪𝓶𝓪 𝓝𝓮𝔀𝓼 ""            "Focus on human… 2017-03-10 …           3448
 3 𝓘𝓻𝓪𝓷 𝓟𝓪𝓷𝓸𝓻𝓪𝓶𝓪 𝓝𝓮𝔀𝓼 ""            "Focus on human… 2017-03-10 …           3448
 4 𝓘𝓻𝓪𝓷 𝓟𝓪𝓷𝓸𝓻𝓪𝓶𝓪 𝓝𝓮𝔀𝓼 ""            "Focus on human… 2017-03-10 …           3448
 5 𝓘𝓻𝓪𝓷 𝓟𝓪𝓷𝓸𝓻𝓪𝓶𝓪 𝓝𝓮𝔀𝓼 ""            "Focus on human… 2017-03-10 …           3448
 6 𝓘𝓻𝓪𝓷 𝓟𝓪𝓷𝓸𝓻𝓪𝓶𝓪 𝓝𝓮𝔀𝓼 ""            "Focus on human… 2017-03-10 …           3448
 7 Heleen Kist_ auth… "Glasgow"     "Author of shor… 2010-12-06 …           7366
 8 Carles Dijous (AA… "Barcelona, … "Colaborador do… 2008-12-28 …           8884
 9 FarNam             ""            "Support #FreeI… 2019-01-19 …           1205
10 Voice of South Az… "Tabriz, Sou… "VOSA is a late… 2019-11-18 …           2988
# ℹ 546,522 more rows
# ℹ 9 more variables: user_friends &lt;chr&gt;, user_favourites &lt;chr&gt;,
#   user_verified &lt;chr&gt;, date &lt;date&gt;, text &lt;chr&gt;, hashtags &lt;chr&gt;, source &lt;chr&gt;,
#   created_at &lt;dttm&gt;, status_id &lt;chr&gt;</code></pre>
</div>
</div>
<p>For this analysis it makes sense to remove stopwords (words which are used often in texts but only contain little meaning). Keeping the words would obscure our correlations, as we would get high correlations containing stopwords and words of interest. This would lead to a high number of more connections that are most likely unimportant to use. Second, keeping stopwords would drive up the computing time. Therefore, we will delete stopwords. We also remove numbers and URLs, which are hard to make sense of out of context.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>iran_tweets_tidy <span class="ot">&lt;-</span> iran_tweets <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">str_remove_all</span>( <span class="co"># remove URls from the text</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    text, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this regular expression finds URLs. I copied it from here</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># https://stackoverflow.com/a/56974986/5028841</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&amp;+]|[!*</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span>   </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">output =</span> <span class="st">"word"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">input =</span> <span class="st">"text"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">token =</span> <span class="st">"words"</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word <span class="sc">%in%</span> stopwords<span class="sc">::</span><span class="fu">stopwords</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Get rid of stopwords</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>, word))) <span class="co"># Get rid of numbers</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>iran_tweets_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_name, word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,038,516 × 2
   user_name word            
   &lt;chr&gt;     &lt;chr&gt;           
 1 pikkolo   savesharmahd    
 2 pikkolo   freedom         
 3 pikkolo   fellow          
 4 pikkolo   german          
 5 pikkolo   jamshid         
 6 pikkolo   sharmahd        
 7 pikkolo   stopexecution   
 8 pikkolo   jamshidsharmahd 
 9 pikkolo   @gazellesharmahd
10 pikkolo   frau            
# ℹ 9,038,506 more rows</code></pre>
</div>
</div>
<p>This removed 0 rows from the <code>data.frame</code>, meaning that number of features is now gone.</p>
<p>To check out this corpus a bit let’s look at the most often occurring words:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>top_words <span class="ot">&lt;-</span> iran_tweets_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>top_words</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 155,819 × 2
   word                n
   &lt;chr&gt;           &lt;int&gt;
 1 mahsaamini     376176
 2 iranrevolution 217797
 3 iran           204570
 4 مهسا_امینی     109778
 5 regime         107469
 6 people         106910
 7 islamic         92511
 8 iranian         87725
 9 iranprotests    69314
10 voice           67379
# ℹ 155,809 more rows</code></pre>
</div>
</div>
<p>We can also check the occurrence some words that seem important over the weeks in our sample:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>important_words <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mahsaamini"</span>, <span class="st">"iranrevolution"</span>, <span class="st">"iran"</span>, <span class="st">" regime"</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"islamic"</span>, <span class="st">"iranian"</span>, <span class="st">"iranprotests"</span>, <span class="st">"freedom"</span>, <span class="st">"women"</span>) </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>iran_tweets_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">%in%</span> important_words) <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(created_at, <span class="st">"months"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, date) <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> pct, <span class="at">fill =</span> word)) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="5_Correlation_and_regression_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="exercise-tasks" class="level3">
<h3 class="anchored" data-anchor-id="exercise-tasks">Exercise Tasks</h3>
<ol type="1">
<li><p>Create a bar chart that shows the overall frequency of the top 10 words over time in the Iran tweets data.</p></li>
<li><p>Look for the top 10 words in the potus data frame</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>potus <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"./data/potus_tweets.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Create a new data frame that contains top 10 bigrams (pairs of two consecutive words) in the iran_tweets_tidy data frame over time.</li>
</ol>
</section>
</section>
<section id="perform-correlation" class="level2">
<h2 class="anchored" data-anchor-id="perform-correlation">Perform correlation</h2>
<p>Before we start with that data, let’s look at some theory behind correlation first. We are going to use the <em>phi coefficient</em> which measures how much more likely it is that either both word X and word Y appear, or neither do, than one appears without the other. Consider this table:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  Items      Has_Word_Y No_Word_Y Total
  &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;
1 Has Word X n_11       n_10      n_1. 
2 No word X  n_01       n_00      n_0. 
3 Total      n_.1       n_.0      n    </code></pre>
</div>
</div>
<p>Here, <span class="math inline">\({n_{11}}\)</span> represents the number of documents where word X <em>and</em> word Y appear <span class="math inline">\({n_{00}}\)</span> represents the number where neither appears. <span class="math inline">\({n_{10}}\)</span> and <span class="math inline">\({n_{01}}\)</span> represent cases where one of the words appear, but not the other. The phi-coefficient then is represented by this formula:</p>
<p><span class="math inline">\(\phi = \frac{n_{11} n_{10} - n_{10} n_{01}}{\sqrt{n_1. n_0. n_.0 n_.1}}\)</span></p>
<p>Correlation among words is measured in a binary form—either the words appear together or they do not. Therefore, the phi-coefficient seems the best choice.</p>
<p>Let’s consider 10 Tweets as an example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>example_tweets_df <span class="ot">&lt;-</span> iran_tweets_tidy <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(status_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"d377750f36b566d0fdd3af5f53e6e45f"</span>, <span class="st">"9b82b10ca54895de312630b83bb8cc12"</span>, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"e776f91ab2e743fafe1677d332344a92"</span>, <span class="st">"4b11035f7d97e9b24e84d92018511a51"</span>, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"d56b9573d1042f55c540a5855503da86"</span>, <span class="st">"09750f7bd47ae6e3530d876daad6d446"</span>, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"f290a6489411154ce8e6fdc10bd4e299"</span>, <span class="st">"2b62022dfd121bbc53e72bc5770d2f02"</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"d14149ebe1ad74a952341e5d5a4e77d9"</span>, <span class="st">"463fb69da0b7e877469dfc9694f5bc7e"</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>example_tweets_dfm <span class="ot">&lt;-</span> example_tweets_df <span class="sc">%&gt;%</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, status_id) <span class="sc">%&gt;%</span> </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"us"</span>, <span class="st">"join"</span>, <span class="st">"solidarity"</span>, <span class="st">"protests"</span>, <span class="st">"special"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> status_id, <span class="at">names_from =</span> word, <span class="at">values_from =</span> n, <span class="at">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>example_tweets_dfm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
  status_id                         join protests solidarity special    us
  &lt;chr&gt;                            &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;int&gt; &lt;int&gt;
1 d377750f36b566d0fdd3af5f53e6e45f     1        0          1       0     1
2 09750f7bd47ae6e3530d876daad6d446     0        1          0       0     0
3 2b62022dfd121bbc53e72bc5770d2f02     0        1          0       1     0</code></pre>
</div>
</div>
<p>We measure the correlation with the <code>cor.test</code> function, which tests for association/correlation between paired samples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(example_tweets_dfm<span class="sc">$</span>protests, example_tweets_dfm<span class="sc">$</span>special)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  example_tweets_dfm$protests and example_tweets_dfm$special
t = 0.57735, df = 1, p-value = 0.6667
alternative hypothesis: true correlation is not equal to 0
sample estimates:
cor 
0.5 </code></pre>
</div>
</div>
<p>Instead of turning the tidy data into a matrix first, we can also use <code>pairwise_cor</code> directly to perform the same test on all words:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>example_tweets_df <span class="sc">%&gt;%</span>  </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairwise_cor</span>(word, status_id, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="co"># find the correlation between words </span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item1 <span class="sc">%in%</span> <span class="st">"protests"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>         item2 <span class="sc">%in%</span> <span class="st">"special"</span>) <span class="co"># look at the words we used above</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  item1    item2   correlation
  &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt;
1 protests special       0.667</code></pre>
</div>
</div>
<p>We could run the correlation on the entire sample, which would lead to a very high number of matches, which would be hard to make sense of though. However, we are not usually interested in all words, but rather in broader patterns. So we can use the <code>top_words</code> data from above to select only the 250 most prevalent ones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span> iran_tweets_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">%in%</span> top_words<span class="sc">$</span>word[<span class="dv">1</span><span class="sc">:</span><span class="dv">250</span>]) <span class="sc">%&gt;%</span>  <span class="co"># only take the 100 top words into account</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairwise_cor</span>(word, status_id, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="co"># find the correlation between words </span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(correlation)) <span class="co"># filter out rows where there is no correlation</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>correlations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 62,250 × 3
   item1         item2         correlation
   &lt;chr&gt;         &lt;chr&gt;               &lt;dbl&gt;
 1 islamic       republic            0.794
 2 republic      islamic             0.794
 3 rights        human               0.732
 4 human         rights              0.732
 5 old           year                0.605
 6 year          old                 0.605
 7 international community           0.545
 8 community     international       0.545
 9 university    students            0.523
10 students      university          0.523
# ℹ 62,240 more rows</code></pre>
</div>
</div>
<section id="exercise-tasks-1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-tasks-1">Exercise Tasks</h3>
<ol type="1">
<li>Show the correlations between the top words in the potus data frame</li>
</ol>
</section>
</section>
<section id="plot-the-network-of-our-most-important-words" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-network-of-our-most-important-words">Plot the network of our most important words</h2>
<p>We can go through the table and would find some interesting connections for sure, but let’s look at a nice network plot, since correlations can be easily plotted as networks with the words being nodes and the strenght of correlations forming the edges.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load packages</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidygraph)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can work with <code>tidygraph</code> to get this into a graph object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>highest_cor_graph <span class="ot">&lt;-</span> correlations <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(correlation <span class="sc">&gt;</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tbl_graph</span>()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>highest_cor_graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tbl_graph: 58 nodes and 74 edges
#
# A directed simple graph with 23 components
#
# A tibble: 58 × 1
  name    
  &lt;chr&gt;   
1 islamic 
2 republic
3 rights  
4 human   
5 old     
6 year    
# ℹ 52 more rows
#
# A tibble: 74 × 3
   from    to correlation
  &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;
1     1     2       0.794
2     2     1       0.794
3     3     4       0.732
# ℹ 71 more rows</code></pre>
</div>
</div>
<p>Under the hood, a graph object consists of two data.frames: one containing the node (in this case the word) one containing the edges (so which words have a connection). Both data.frames can be altered, for example to add more attributes about nodes and edges. In our case the only attribute we have is the size of the correlation, stored in the edge data.frame.</p>
<p>Using this new object we can easily plot the correlations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>highest_cor_graph <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout =</span> <span class="st">"graphopt"</span>) <span class="sc">+</span> <span class="co">#start plot</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> name), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># set nodes, color depends on item1, size of nodes should always be 5</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">edge_alpha =</span> correlation), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co">#include edges, which are based on value of correlation</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">repel =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="co">#include words in our graph</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="co">#Set white background</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using the `size` aesthetic in this geom was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` in the `default_aes` field and elsewhere instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="5_Correlation_and_regression_files/figure-html/ggraph-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Using the command <code>ggsave</code>, we can save this as a PDF, which is often easier to look at with big plots, since you can zoom in:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"5_network_plot.pdf"</span>, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that <code>ggsave</code> saves the last plot you did by default. Find out more about the function with <code>?ggsave</code>.</p>
<p>Why does this matter? Sometimes the bag-of-words strategy does not work well as two words essentially for one term. Correlations are a good way to find so-called n-grams, meaning bigrams (e.g., “human_right”) trigrams (e.g., “The United States”) that you should concatenate before preprocessing (e.g., with <code>unnest_tokens</code>). Besides that, it makes the point that text data can be explored by turning it into numbers :)</p>
<section id="exercise-tasks-2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-tasks-2">Exercise Tasks</h3>
<ol type="1">
<li><p><code>ggraph()</code> has a layout option. See if you can find a layout that is more informative for the last plot.</p></li>
<li><p>Using the <code>unnest_tokens</code> function, create a new dataset with the bigrams and trigrams found in the dataset. Compare the results to the original dataset and discuss the differences.</p></li>
</ol>
</section>
</section>
</section>
<section id="regression" class="level1">
<h1>Regression</h1>
<p>In this section, we will use supervised machine learning (SML) to predict continuous values that are associated with text data. SML can be divided into two types</p>
<ul>
<li>A* <strong>classification</strong> model predicts a class label or group membership.</li>
<li>A* <strong>regression</strong> model predicts a numeric or continuous value.</li>
</ul>
<p>Most people think about classification when they hear SML, but it is actually possible to use standard algorithms that you would usually think of as statistics to predict continuous rather than categorical variables. In the Iran dataset, the date comes to mind as something we could try to predict. Let’s have a look:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>iran_tweets_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(status_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(date, <span class="st">"months"</span>)) <span class="sc">%&gt;%</span> <span class="co"># used to make plot easier to read</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`position_stack()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="5_Correlation_and_regression_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To make the variable easier to interpret, we convert the date into days since the first tweet using a small function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>day_diff <span class="ot">&lt;-</span> <span class="cf">function</span>(dates) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  first_date <span class="ot">&lt;-</span> <span class="fu">min</span>(dates)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.integer</span>(dates <span class="sc">-</span> first_date, <span class="at">units =</span> <span class="st">"days"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># let's test this</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">day_diff</span>(<span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2023-01-01"</span>, <span class="st">"2023-02-01"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0 31</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>iran_tweets_tidy_mc <span class="ot">&lt;-</span> iran_tweets_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(date)) <span class="sc">%&gt;%</span> <span class="co"># remove the 2 NA Dates</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_nr =</span> <span class="fu">day_diff</span>(date))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>iran_tweets_tidy_mc <span class="sc">%&gt;%</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(status_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(day_nr) <span class="sc">%&gt;%</span> </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day_nr, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="5_Correlation_and_regression_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It’s not as easy to look at, but will work for our purposes. Next, we need to select some independent variables. I use the 1,000 most prevalent words and turn our long format data into the wide format the regression function expects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>top_words_chr <span class="ot">&lt;-</span> top_words <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(word)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>iran_tweets_tidy_mc_dfm <span class="ot">&lt;-</span> iran_tweets_tidy_mc <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">%in%</span> top_words_chr) <span class="sc">%&gt;%</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, status_id, day_nr) <span class="sc">%&gt;%</span> </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> word, <span class="at">values_from =</span> n, <span class="at">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>iran_tweets_tidy_mc_dfm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 546,237 × 1,002
   status_id              day_nr `@abaerbock` `@abc` `@abcnews` `@alinejadmasih`
   &lt;chr&gt;                   &lt;int&gt;        &lt;int&gt;  &lt;int&gt;      &lt;int&gt;            &lt;int&gt;
 1 001d2f682f9c4a5293f00…     31            1      0          0                0
 2 00830ec0521895c9da129…     85            1      0          0                0
 3 00862cabc108f76336acd…     95            1      0          0                0
 4 00b01380441c8395f9ff5…    178            1      0          0                0
 5 00b50657db943e5118276…     44            1      0          0                0
 6 00beed7f061d0344b7539…     16            1      0          0                0
 7 00ca1c8cfbc60eaecc928…    104            1      0          0                0
 8 00d4eb78dc7332c2c5637…     31            1      0          0                0
 9 00d8e1f3a5041a8a36eeb…    120            1      0          0                0
10 00e00c1ed30d6148342e5…     35            1      0          0                0
# ℹ 546,227 more rows
# ℹ 996 more variables: `@amirabdolahian` &lt;int&gt;, `@amnesty` &lt;int&gt;,
#   `@amnestyiran` &lt;int&gt;, `@anonymousopiran` &lt;int&gt;, `@ap` &lt;int&gt;,
#   `@bbcworld` &lt;int&gt;, `@canadianpm` &lt;int&gt;, `@cbcnews` &lt;int&gt;, `@cbsnews` &lt;int&gt;,
#   `@chelseahartisme` &lt;int&gt;, `@cnn` &lt;int&gt;, `@cnnbrk` &lt;int&gt;, `@cnni` &lt;int&gt;,
#   `@dwnews` &lt;int&gt;, `@elonmusk` &lt;int&gt;, `@emilykschrader` &lt;int&gt;,
#   `@emmanuelmacron` &lt;int&gt;, `@esmaeilion` &lt;int&gt;, `@eu_commission` &lt;int&gt;, …</code></pre>
</div>
</div>
<p>The idea of machine learning is to predict some new cases. We can evaluate the performance of a model by removing some cases beforehand and then testing the model against the true value of these test cases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>training_ids <span class="ot">&lt;-</span> iran_tweets_tidy_mc_dfm <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(status_id)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>training_data <span class="ot">&lt;-</span> iran_tweets_tidy_mc_dfm <span class="sc">%&gt;%</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(status_id <span class="sc">%in%</span> training_ids)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> iran_tweets_tidy_mc_dfm <span class="sc">%&gt;%</span> </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>status_id <span class="sc">%in%</span> training_ids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use the normal <code>lm()</code> function on the data with <code>day_nr</code> as dependant and everything else (except status_id) as independant variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(day_nr <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">select</span>(training_data, <span class="sc">-</span>status_id))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># you can run summary for fun but it will print almost all words</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(model)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One interesting side effect of this is that the coefficients tell us which words can be used to predict an early or late tweet:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>coef_df <span class="ot">&lt;-</span> <span class="fu">coef</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">coef =</span> <span class="fu">names</span>(.), <span class="at">value =</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coef <span class="sc">!=</span> <span class="st">"(Intercept)"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>coef_df <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 2
   coef                             value
   &lt;chr&gt;                            &lt;dbl&gt;
 1 irgcterorrists                    56.8
 2 irgcterrorists                    51.6
 3 march                             49.2
 4 february                          45.1
 5 مرگ_بر_ستمگر_چه_شاه_باشه_چه_رهبر  37.7
 6 feb                               37.5
 7 mekterrorists                     36.9
 8 `@hadjalahbib`                    33.2
 9 walkoutiri                        28.7
10 mohammadmoradi                    26.1
# ℹ 990 more rows</code></pre>
</div>
</div>
<p>The word “march” and “february” predict later tweets, which makes sense given that the latest tweets that were collected are from March. “mekterrorists”, however, is an interesting one, suggesting that this organisation (which advocates overthrowing the government of Iran) has only been discussed more recently.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>coef_df <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 2
   coef               value
   &lt;chr&gt;              &lt;dbl&gt;
 1 befairun           -29.0
 2 sharifuniversity   -24.4
 3 petrochemical      -19.8
 4 opiran             -19.4
 5 `mahsa_amini‌`      -18.8
 6 `mahsaamini's`     -18.8
 7 oplran             -18.2
 8 iranianlivesmatter -17.9
 9 آزادی_آزادی_آزادی  -17.0
10 ambulances         -16.5
# ℹ 990 more rows</code></pre>
</div>
</div>
<p>At the other side of the spectrum we see several of the hashtags used at the start of the protests.</p>
<p>To evaluate the model, we predict values for day in the test set, using the words of the texts in there and the model. We then plot the predicted values against the true ones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>test_data_predict <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day_nr_predict =</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> <span class="fu">select</span>(test_data, <span class="sc">-</span>status_id)))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>test_data_predict <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day_nr, <span class="at">y =</span> day_nr_predict)) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Truth"</span>,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Predicted Day"</span>,</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Predicted and true days for tweets about #IranProtests2022"</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="5_Correlation_and_regression_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that the fit is not great, with some negative day values and quite a bit of mis-prediction. But we can still see a trend and that the model is actually predicted something and does not return random results. Given that language does not shift that dramatically over time, this is still quite interesting.</p>
<section id="exercise-tasks-3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-tasks-3">Exercise Tasks</h3>
<ol type="1">
<li>In the State of the Union Addresses, turn the year into a continuous variable starting with 1</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sotu)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>sotu <span class="ot">&lt;-</span> sotu_meta <span class="sc">%&gt;%</span>  </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">text =</span> sotu_text) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li><p>Get the top 500 words from the sotu data</p></li>
<li><p>Run a OLS with the year as dependent variable</p></li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>